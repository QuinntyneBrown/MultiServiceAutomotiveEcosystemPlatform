<div class="customer-registration">
  <div class="customer-registration__container">
    <div class="customer-registration__card">
      <!-- Header -->
      <div class="customer-registration__header">
        <h1 class="customer-registration__title">Create Account</h1>
        <p class="customer-registration__subtitle">Join our automotive services platform</p>
      </div>

      <!-- Referral Banner -->
      @if (referrer) {
        <div class="customer-registration__referral-banner" role="alert">
          <svg class="customer-registration__referral-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <div class="customer-registration__referral-content">
            <p class="customer-registration__referral-text">
              <strong>{{ referrer.name }}</strong> invited you!
            </p>
            @if (referrer.discount) {
              <p class="customer-registration__referral-discount">
                Get {{ referrer.discount }} off your first service
              </p>
            }
          </div>
        </div>
      }

      <!-- Error Message -->
      @if (errorMessage()) {
        <div class="customer-registration__alert customer-registration__alert--error" role="alert">
          <svg class="customer-registration__alert-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
          </svg>
          <p class="customer-registration__alert-message">{{ errorMessage() }}</p>
        </div>
      }

      <!-- Social Login -->
      @if (enableSocialLogin && socialProviders.length > 0) {
        <div class="customer-registration__social">
          @for (provider of socialProviders; track provider) {
            <button
              type="button"
              class="customer-registration__social-button customer-registration__social-button--{{provider}}"
              (click)="onSocialLogin(provider)"
              [attr.aria-label]="'Sign up with ' + provider"
            >
              <span class="customer-registration__social-icon">
                @if (provider === 'google') {
                  <svg width="18" height="18" viewBox="0 0 18 18">
                    <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                    <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                    <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z"/>
                    <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.293C4.672 5.163 6.656 3.58 9 3.58z"/>
                  </svg>
                }
                @if (provider === 'facebook') {
                  <svg width="18" height="18" viewBox="0 0 18 18">
                    <path fill="#1877F2" d="M18 9c0-4.97-4.03-9-9-9S0 4.03 0 9c0 4.49 3.29 8.21 7.59 8.88v-6.28H5.31V9h2.28V7.03c0-2.25 1.34-3.49 3.39-3.49.98 0 2.01.18 2.01.18v2.21h-1.13c-1.11 0-1.46.69-1.46 1.4V9h2.48l-.4 2.6h-2.08v6.28C14.71 17.21 18 13.49 18 9z"/>
                  </svg>
                }
                @if (provider === 'apple') {
                  <svg width="18" height="18" viewBox="0 0 18 18">
                    <path d="M14.94 5.19A4.38 4.38 0 0 0 16 2.53 4.44 4.44 0 0 0 13.53 4a4.17 4.17 0 0 0 1.41 1.19zm-2.47 7.78a3.91 3.91 0 0 1 1.86-3.28 4 4 0 0 0-3.14-1.7c-1.34-.14-2.61.79-3.29.79s-1.72-.77-2.82-.75a4.19 4.19 0 0 0-3.52 2.15c-1.5 2.6-.39 6.45 1.08 8.56.72 1 1.58 2.19 2.71 2.15s1.49-.7 2.8-.7 1.67.7 2.82.68 1.92-1.08 2.64-2.11a9.34 9.34 0 0 0 1.2-2.45 3.79 3.79 0 0 1-2.34-3.34z"/>
                  </svg>
                }
              </span>
              <span class="customer-registration__social-text">
                Continue with {{ provider === 'google' ? 'Google' : provider === 'facebook' ? 'Facebook' : 'Apple' }}
              </span>
            </button>
          }
        </div>

        <div class="customer-registration__divider">
          <span class="customer-registration__divider-text">Or sign up with email</span>
        </div>
      }

      <!-- Registration Form -->
      <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" class="customer-registration__form">
        <!-- Name Fields -->
        <div class="customer-registration__name-group">
          <div class="customer-registration__field">
            <label for="firstName" class="customer-registration__label">
              First Name <span class="customer-registration__required">*</span>
            </label>
            <input
              id="firstName"
              type="text"
              formControlName="firstName"
              class="customer-registration__input"
              [class.customer-registration__input--error]="firstNameError"
              placeholder="John"
              autocomplete="given-name"
            />
            @if (firstNameError) {
              <p class="customer-registration__error">{{ firstNameError }}</p>
            }
          </div>

          <div class="customer-registration__field">
            <label for="lastName" class="customer-registration__label">
              Last Name <span class="customer-registration__required">*</span>
            </label>
            <input
              id="lastName"
              type="text"
              formControlName="lastName"
              class="customer-registration__input"
              [class.customer-registration__input--error]="lastNameError"
              placeholder="Doe"
              autocomplete="family-name"
            />
            @if (lastNameError) {
              <p class="customer-registration__error">{{ lastNameError }}</p>
            }
          </div>
        </div>

        <!-- Email Field -->
        <div class="customer-registration__field">
          <label for="email" class="customer-registration__label">
            Email Address <span class="customer-registration__required">*</span>
          </label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="customer-registration__input"
            [class.customer-registration__input--error]="emailError"
            placeholder="you@example.com"
            autocomplete="email"
          />
          @if (emailError) {
            <p class="customer-registration__error">{{ emailError }}</p>
          }
        </div>

        <!-- Phone Field -->
        <div class="customer-registration__field">
          <label for="phone" class="customer-registration__label">
            Phone Number <span class="customer-registration__required">*</span>
          </label>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            (input)="formatPhoneNumber($event)"
            class="customer-registration__input"
            [class.customer-registration__input--error]="phoneError"
            placeholder="(555) 123-4567"
            autocomplete="tel"
            maxlength="14"
          />
          @if (phoneError) {
            <p class="customer-registration__error">{{ phoneError }}</p>
          }
        </div>

        <!-- Password Field -->
        <div class="customer-registration__field">
          <label for="password" class="customer-registration__label">
            Password <span class="customer-registration__required">*</span>
          </label>
          <div class="customer-registration__password-wrapper">
            <input
              id="password"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              class="customer-registration__input customer-registration__input--password"
              [class.customer-registration__input--error]="passwordError"
              placeholder="Enter your password"
              autocomplete="new-password"
            />
            <button
              type="button"
              class="customer-registration__password-toggle"
              (click)="togglePasswordVisibility('password')"
              [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'"
            >
              @if (showPassword()) {
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              } @else {
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
                  <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                </svg>
              }
            </button>
          </div>
          
          <!-- Password Strength Indicator -->
          @if (registrationForm.get('password')?.value) {
            <div class="customer-registration__password-strength">
              <div class="customer-registration__strength-bar">
                <div 
                  class="customer-registration__strength-fill"
                  [style.width.%]="passwordStrengthPercent"
                  [style.background-color]="passwordStrengthColor"
                ></div>
              </div>
              <p class="customer-registration__strength-text">
                Password strength: <strong>{{ passwordStrength() }}</strong>
              </p>
            </div>
          }
          
          @if (passwordError) {
            <p class="customer-registration__error">{{ passwordError }}</p>
          }
        </div>

        <!-- Confirm Password Field -->
        <div class="customer-registration__field">
          <label for="confirmPassword" class="customer-registration__label">
            Confirm Password <span class="customer-registration__required">*</span>
          </label>
          <div class="customer-registration__password-wrapper">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              class="customer-registration__input customer-registration__input--password"
              [class.customer-registration__input--error]="confirmPasswordError"
              placeholder="Confirm your password"
              autocomplete="new-password"
            />
            <button
              type="button"
              class="customer-registration__password-toggle"
              (click)="togglePasswordVisibility('confirmPassword')"
              [attr.aria-label]="showConfirmPassword() ? 'Hide password' : 'Show password'"
            >
              @if (showConfirmPassword()) {
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                  <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                </svg>
              } @else {
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
                  <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                </svg>
              }
            </button>
          </div>
          @if (confirmPasswordError) {
            <p class="customer-registration__error">{{ confirmPasswordError }}</p>
          }
        </div>

        <!-- Marketing Consent -->
        <div class="customer-registration__checkbox">
          <input
            id="marketingConsent"
            type="checkbox"
            formControlName="marketingConsent"
            class="customer-registration__checkbox-input"
          />
          <label for="marketingConsent" class="customer-registration__checkbox-label">
            Send me promotional emails and updates
          </label>
        </div>

        <!-- Terms & Conditions -->
        <div class="customer-registration__checkbox">
          <input
            id="termsAccept"
            type="checkbox"
            formControlName="termsAccept"
            class="customer-registration__checkbox-input"
            [class.customer-registration__checkbox-input--error]="termsError"
          />
          <label for="termsAccept" class="customer-registration__checkbox-label">
            I agree to the <a href="/terms" class="customer-registration__link">Terms & Conditions</a> and 
            <a href="/privacy" class="customer-registration__link">Privacy Policy</a>
            <span class="customer-registration__required">*</span>
          </label>
        </div>
        @if (termsError) {
          <p class="customer-registration__error customer-registration__error--checkbox">{{ termsError }}</p>
        }

        <!-- Submit Button -->
        <button
          type="submit"
          class="customer-registration__submit"
          [class.customer-registration__submit--loading]="isSubmitting()"
          [disabled]="isSubmitting()"
        >
          @if (isSubmitting()) {
            <svg class="customer-registration__spinner" width="20" height="20" viewBox="0 0 20 20">
              <circle class="customer-registration__spinner-circle" cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>Creating account...</span>
          } @else {
            <span>Create Account</span>
          }
        </button>
      </form>

      <!-- Login Link -->
      <p class="customer-registration__footer">
        Already have an account? 
        <a href="/login" class="customer-registration__link">Sign in</a>
      </p>
    </div>
  </div>
</div>
